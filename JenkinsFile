pipeline{
    agent any
    environment{
        PATH="$PATH:/opt/apache-maven-3.6.3/bin"
    }
    stages{
        
        stage('Get Code'){
            steps{
                git 'https://github.com/Rashid-Khan-Github/mavenapp.git'
            }
        }
        stage('Build Code'){
            steps{
                sh 'mvn clean package'
            }
        }
         stage('Code Review'){
            steps{
                withSonarQubeEnv('Sonar-Server-8.9.1') {
                    sh 'mvn sonar:sonar'
                }
            }
        }
         stage('Deployement'){
            steps{
                sshagent(['Tomcat-Server-Agent']) {
                    sh 'scp -o StrictHostKeyChecking=no target/01MavenWebApp.war ec2-user@54.175.50.56:/home/ec2-user/apache-tomcat-9.0.73/webapps'
                }
            }
        }
    }
}
